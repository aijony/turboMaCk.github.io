<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Elm 0.17 - Successful Upgrade of Real World App</title>
    <link rel="icon" type="image/png" href="../favicon.png" />
    <link href="https://fonts.googleapis.com/css?family=Cabin:400,400i,700,700i|Open+Sans:400,400i,700,700i&amp;subset=latin-ext" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../css/default.css" />
  </head>
  <body>
    <header class="page-header">
        <nav class="navigation">
            
                <a href="../">Home</a>
                <a href="../archive.html" class="active">B\og</a>
            
        </nav>
    </header>

    <main class="main-container">
      <div class="content">
        <h1>
          Elm 0.17 - Successful Upgrade of Real World App
          
            <span class="subtitle">…and some soft of guide to all of this</span>
          
        </h1>

        <div class="info">
    Posted on May 15, 2016
    
</div>

<p><em>Note: This is mirror of my <a href="https://medium.com/@turbo_MaCk/elm-0-17-successful-upgrade-of-real-world-app-and-some-soft-of-guide-to-all-of-this-cafd59dec56f">original</a> article published on medium.</em></p>
<p>It has been few month since I’ve started learning <a href="http://elm-lang.org/">Elm programming language</a>. I’ve been walking around elm for quite a while without ever touching it. However not so long ago I’ve decided to learn some statically typed functional language started reading <a href="http://learnyouahaskell.com/">Learn You Haskell for Great Good!</a> and so I also finally put my hands on Elm. I’ve learned bit of syntax, core library, types, Signals, Effects, Mailboxes and <a href="https://github.com/evancz/elm-architecture-tutorial">Elm architecture</a>. It was quite interesting journey. Soon I’ll become wonder if I’ll be able to write some smaller project from end to start just using elm. Some kind of real world application to challenge myself and also this world of typed purity. I wanted it to talk to some JSON API and use Html. Github’s API seems to be good think to start with so I start writing github repository browser in elm. <a href="http://turbomack.github.io/elm-github-repos/">This is demo of app I’m talking about</a>.</p>
<p>Just few days ago to me unexpected thing happens. <a href="http://elm-lang.org/blog/farewell-to-frp">Elm 0.17 release was announced!</a> I remember myslef reading that announcement and thinking “Omg, what’s going on?!”. From that moment Signals, Messages, Effects and Mailboxes are past of Elm. What should I think of it?</p>
<blockquote class="twitter-tweet" data-lang="en">
<p lang="en" dir="ltr">
<a href="https://twitter.com/rabbitonweb"><span class="citation">@rabbitonweb</span></a> I'm not sure yet. It's interesting and scary at the same time.
</p>
— Marek Fajkus (<span class="citation">@turbo_MaCk</span>) <a href="https://twitter.com/turbo_MaCk/status/730355729778020352">May 11, 2016</a>
</blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>This was really huge change in how everybody (including me) thinks about building web apps in Elm. We all know these kind of changes are really hard to bring in practice since you already have large codebase around your ecosystem. In that moment that app I wrote few month ago came to my mind. It looks like all <a href="http://package.elm-lang.org/">packages</a> it needs are ready for 0.17. Plan was made and yesterday I finally found some time and started with upgrade to 0.17.</p>
<p>Upgrading is always painful. It really is. I’m working on pretty large Ember.js application at my company. Ember core team is pretty careful about their <a href="http://emberjs.com/deprecations/v1.x/">deprecation planing</a>. Anyway upgrading that app was (and is) a huge pain. It’s always complicated when you have tens of thousands of code lines and large test suits already written for legacy API.</p>
<p>Such a big design change that Elm 0.17 brings to its ecosystem is something that can easily kill any JavaScript framework. Remember Angular 1.x vs 2.x? Express.js vs Koa.js?</p>
<p>Luckily I have pretty small app which seems to be good candidate for going through this big upgrade process. I was not afraid of starting with upgrade since I was able to write whole app in just one day or so. Even if it turns out to be complete rewrite it can still be done over weekend.</p>
<p>One thing is particularly hard when starting with any upgrade which is to find some pattern and split work into few smaller iterations where each has its own goal. Mostly you can’t rewrite whole app at once. This is no how you design it and it shouldn’t be the way how you refactor it as well.</p>
<p>To be honest I was quite chaotic when I started with this upgrad but soon I realised some (or way how you can split upgrade into smaller iterations if you want) and this is why I’m sharing this story with you. No matter how big your project is I think you can apply these steps in order to make whole upgrade process of your elm 0.16 to 0.17 sooth and fun.</p>
<p><strong>Note: This article is just about upgrading web app based on elm-html. I also have one project written with canvas backend (it’s kind of game) and other one as a library backed up just by elm-test. Anyway I will not focus on nether of these projects.</strong></p>
<h2 id="lets-get-started">Lets get started</h2>
<p>You can check or clone whole 0.16 version code from <a href="https://github.com/turboMaCk/elm-github-repos/tree/v0.16">Github under v0.16 tag</a>. With our legacy code and <a href="https://github.com/elm-lang/elm-platform/blob/master/upgrade-docs/0.17.md">Upgrading to 0.17 guide</a> opened we are ready to try what new Elm is about.</p>
<h2 id="new-dependencies">New dependencies</h2>
<p>This is pretty straight forward. We can almost copy/paste this part from upgrade guide so Lets open elm-package.json in your favorite <a href="https://www.gnu.org/software/emacs/">Emacs</a> and get it done.</p>
<p><strong>Old version:</strong></p>
<div class="sourceCode"><pre class="sourceCode json"><code class="sourceCode json"><span class="fu">{</span>
    <span class="dt">&quot;version&quot;</span><span class="fu">:</span> <span class="st">&quot;1.0.0&quot;</span><span class="fu">,</span>
    <span class="dt">&quot;summary&quot;</span><span class="fu">:</span> <span class="st">&quot;helpful summary of your project, less than 80 characters&quot;</span><span class="fu">,</span>
    <span class="dt">&quot;repository&quot;</span><span class="fu">:</span> <span class="st">&quot;https://github.com/user/project.git&quot;</span><span class="fu">,</span>
    <span class="dt">&quot;license&quot;</span><span class="fu">:</span> <span class="st">&quot;BSD3&quot;</span><span class="fu">,</span>
    <span class="dt">&quot;source-directories&quot;</span><span class="fu">:</span> <span class="ot">[</span>
        <span class="st">&quot;.&quot;</span>
    <span class="ot">]</span><span class="fu">,</span>
    <span class="dt">&quot;exposed-modules&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span>
    <span class="dt">&quot;dependencies&quot;</span><span class="fu">:</span> <span class="fu">{</span>
        <span class="dt">&quot;deadfoxygrandpa/elm-test&quot;</span><span class="fu">:</span> <span class="st">&quot;3.1.0 &lt;= v &lt; 4.0.0&quot;</span><span class="fu">,</span>
        <span class="dt">&quot;elm-lang/core&quot;</span><span class="fu">:</span> <span class="st">&quot;3.0.0 &lt;= v &lt; 4.0.0&quot;</span><span class="fu">,</span>
        <span class="dt">&quot;evancz/elm-effects&quot;</span><span class="fu">:</span> <span class="st">&quot;2.0.1 &lt;= v &lt; 3.0.0&quot;</span><span class="fu">,</span>
        <span class="dt">&quot;evancz/elm-html&quot;</span><span class="fu">:</span> <span class="st">&quot;4.0.2 &lt;= v &lt; 5.0.0&quot;</span><span class="fu">,</span>
        <span class="dt">&quot;evancz/elm-http&quot;</span><span class="fu">:</span> <span class="st">&quot;3.0.0 &lt;= v &lt; 4.0.0&quot;</span><span class="fu">,</span>
        <span class="dt">&quot;evancz/start-app&quot;</span><span class="fu">:</span> <span class="st">&quot;2.0.2 &lt;= v &lt; 3.0.0&quot;</span>
    <span class="fu">},</span>
    <span class="dt">&quot;elm-version&quot;</span><span class="fu">:</span> <span class="st">&quot;0.16.0 &lt;= v &lt; 0.17.0&quot;</span>
<span class="fu">}</span></code></pre></div>
<p><strong>New version:</strong></p>
<div class="sourceCode"><pre class="sourceCode json"><code class="sourceCode json"><span class="fu">{</span>
    <span class="dt">&quot;version&quot;</span><span class="fu">:</span> <span class="st">&quot;1.0.0&quot;</span><span class="fu">,</span>
    <span class="dt">&quot;summary&quot;</span><span class="fu">:</span> <span class="st">&quot;helpful summary of your project, less than 80 characters&quot;</span><span class="fu">,</span>
    <span class="dt">&quot;repository&quot;</span><span class="fu">:</span> <span class="st">&quot;https://github.com/user/project.git&quot;</span><span class="fu">,</span>
    <span class="dt">&quot;license&quot;</span><span class="fu">:</span> <span class="st">&quot;BSD3&quot;</span><span class="fu">,</span>
    <span class="dt">&quot;source-directories&quot;</span><span class="fu">:</span> <span class="ot">[</span>
        <span class="st">&quot;.&quot;</span>
    <span class="ot">]</span><span class="fu">,</span>
    <span class="dt">&quot;exposed-modules&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span>
    <span class="dt">&quot;dependencies&quot;</span><span class="fu">:</span> <span class="fu">{</span>
        <span class="dt">&quot;elm-lang/core&quot;</span><span class="fu">:</span> <span class="st">&quot;4.0.0 &lt;= v &lt; 5.0.0&quot;</span><span class="fu">,</span>
        <span class="dt">&quot;elm-lang/html&quot;</span><span class="fu">:</span> <span class="st">&quot;1.0.0 &lt;= v &lt; 2.0.0&quot;</span><span class="fu">,</span>
        <span class="dt">&quot;evancz/elm-http&quot;</span><span class="fu">:</span> <span class="st">&quot;3.0.1 &lt;= v &lt; 4.0.0&quot;</span>
    <span class="fu">},</span>
    <span class="dt">&quot;elm-version&quot;</span><span class="fu">:</span> <span class="st">&quot;0.17.0 &lt;= v &lt; 0.18.0&quot;</span>
<span class="fu">}</span></code></pre></div>
<p><em>Note: As you can see I’m a little bit sloppy. Almost all meta is not filled out but since this was never published (and never will be) as package we just leave it as it is for now. One more thing to mention is that there is elm-test specified as dependency in legacy version but I actually never used it in this project. This is why it’s not in updated version.</em></p>
<p>Then we run package install as usual:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="ex">elm-package</span> install</code></pre></div>
<h2 id="module-declaration">Module Declaration</h2>
<p>With new packages installed we can start rewriting application logic for new APIs. One smaller change is to update model declaration to new syntax. Replace:</p>
<pre><code>module Repos where</code></pre>
<p>with:</p>
<pre><code>module Repos exposing (main)</code></pre>
<p>We can also change imports to match new module structure.</p>
<p>Here is complete old version and new equivalent:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">module</span> <span class="dt">Repos</span> <span class="kw">where</span>

<span class="kw">import </span><span class="dt">List</span>
<span class="kw">import </span><span class="dt">Graphics.Element</span> exposing (..)
<span class="kw">import </span><span class="dt">Http</span>
<span class="kw">import </span><span class="dt">Json.Decode</span> <span class="kw">as</span> <span class="dt">Json</span> exposing ((:=))
<span class="kw">import </span><span class="dt">Task</span>
<span class="kw">import </span><span class="dt">Signal</span>
<span class="kw">import </span><span class="dt">Html</span> exposing (..)
<span class="kw">import </span><span class="dt">Html.Attributes</span> exposing (..)
<span class="kw">import </span><span class="dt">Html.Events</span> <span class="kw">as</span> <span class="dt">Events</span>
<span class="kw">import </span><span class="dt">Effects</span> exposing (<span class="dt">Effects</span>)
<span class="kw">import </span><span class="dt">StartApp</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">module</span> <span class="dt">Repos</span> exposing (main)

<span class="kw">import </span><span class="dt">List</span>
<span class="kw">import </span><span class="dt">Html</span> exposing (..)
<span class="kw">import </span><span class="dt">Html.App</span>
<span class="kw">import </span><span class="dt">Html.Attributes</span> exposing (..)
<span class="kw">import </span><span class="dt">Html.Events</span> <span class="kw">as</span> <span class="dt">Events</span>
<span class="kw">import </span><span class="dt">Http</span>
<span class="kw">import </span><span class="dt">Json.Decode</span> <span class="kw">as</span> <span class="dt">Json</span> exposing ((:=))
<span class="kw">import </span><span class="dt">Task</span> exposing (..)</code></pre></div>
<p>As you can see this app needs much less modules using 0.17.</p>
<h2 id="views-startapp">Views + StartApp</h2>
<p>Next step according to upgrade guide should be replacing Action with Msg. Anyway I’d like to start with views since my first goal is to be able to render initial state of application. We will go back to update function in a minute.</p>
<p>What I did is to get rid off address passing from view, change type annotations and comment out all events. This is basically what needs to be done:</p>
<p>replace:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">view <span class="fu">:</span> <span class="dt">Signal.Address</span> <span class="dt">Action</span> <span class="ot">-&gt;</span> <span class="dt">Model</span> <span class="ot">-&gt;</span> <span class="dt">Html</span>
view address model <span class="fu">=</span></code></pre></div>
<p>with:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">view <span class="fu">:</span> <span class="dt">Model</span> <span class="ot">-&gt;</span> <span class="dt">Html</span> <span class="dt">Msg</span>
view model <span class="fu">=</span></code></pre></div>
<p>replace also all calls to “sub views”</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">div [ <span class="kw">class</span> “app<span class="fu">-</span>container” ]
    [ headerView address model ]</code></pre></div>
<p>with something like</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">div [ <span class="kw">class</span> “app<span class="fu">-</span>container” ]
    [ headerView model ]</code></pre></div>
<p>And finally comment out Events (we get back to them later):</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">div
    [ <span class="kw">class</span> “repo<span class="fu">-</span>main”
    <span class="co">-- , Events.onClick address (SelectRepo repo)</span>
    ]</code></pre></div>
<p>I also had custom Events for input and submit. In this step we can simply comment them out.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="fu">-</span>— onInput <span class="fu">:</span> <span class="dt">Signal.Address</span> <span class="dt">Action</span> <span class="ot">-&gt;</span> (<span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Action</span>) <span class="ot">-&gt;</span> <span class="dt">Attribute</span>
—<span class="fu">-</span> onInput address f <span class="fu">=</span>
    —<span class="fu">-</span> Events.on “input” Events.targetValue (\v <span class="ot">-&gt;</span> Signal.message address (f v))

—<span class="fu">-</span> oSubmit address value <span class="fu">=</span>
    —<span class="fu">-</span> Events.onWithOptions “submit”
        —<span class="fu">-</span> { stopPropagation <span class="fu">=</span> <span class="dt">True</span>, preventDefault <span class="fu">=</span> <span class="dt">True</span> }
        —<span class="fu">-</span> Json.value (\_ <span class="ot">-&gt;</span> Signal.message address (<span class="dt">FetchData</span> value))</code></pre></div>
<p>If you now try to compile app you can still see compile error. <strong>We no longer need port in 0.17!</strong> Let’s remove it then!</p>
<h3 id="fixing-glue">Fixing glue</h3>
<p>Now we can see much more reasonable errors during compilation. Mostly legacy Effects stuff, missing Msg type and StartApp. Let’s fix this one by one.</p>
<p>Firstly we can <strong>comment out all Effects stuff</strong> since our first goal is to render initial state. Also we need to get rid off all calls to these functions. For now lets replace every call in <strong>update</strong> with <strong>Cmd.none</strong> which is replacement for legacy <strong>Effects.none</strong>.</p>
<p>Also it looks like we are now in update function part so lets change <strong>Action</strong> type to new <strong>Msg</strong> and refactor arguments according to guide.</p>
<p>This is how update action looks like after these changes:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">update <span class="fu">:</span> <span class="dt">Msg</span> <span class="ot">-&gt;</span> <span class="dt">Model</span> <span class="ot">-&gt;</span> (<span class="dt">Model</span>, <span class="dt">Cmd</span> <span class="dt">Msg</span>)
update action model <span class="fu">=</span>
    <span class="kw">case</span> action <span class="kw">of</span>
        <span class="dt">NoOp</span> <span class="ot">-&gt;</span>
            ( model, Cmd.none )
    <span class="dt">FetchData</span> name <span class="ot">-&gt;</span>
        ( { model
            <span class="fu">|</span> isLoading <span class="fu">=</span> <span class="dt">True</span>
            , resultsFor <span class="fu">=</span> model<span class="fu">.</span>userName }
            , Cmd.none )
            —<span class="fu">-</span> , fetchDataAsEffects model<span class="fu">.</span>userName )
    <span class="dt">FetchDone</span> results <span class="ot">-&gt;</span>
        ( { model
            <span class="fu">|</span> repos <span class="fu">=</span> results
            , isLoading <span class="fu">=</span> <span class="dt">False</span>
            , alert <span class="fu">=</span> “” }
            , Cmd.none )</code></pre></div>
<p><em>Note: This is just simplified version, but you get the idea…</em></p>
<p>I my case I also need to change initialState since fetchData function is also called in this place. I’ll replace it with <strong>Cmd.none</strong> too.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">init <span class="fu">:</span> ( <span class="dt">Model</span>, <span class="dt">Cmd</span> <span class="dt">Msg</span> )
init <span class="fu">=</span>
    ( initialModel
    , Cmd.none )
    — , fetchDataAsEffects initialModel<span class="fu">.</span>userName )</code></pre></div>
<p>At last but not least we still did not change main function and legacy StartApp code. This can be copy/pasted from upgrade guide. Result looks like this:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">main <span class="fu">:</span> <span class="dt">Program</span> <span class="dt">Never</span>
main <span class="fu">=</span>
    Html.App.program
        { init <span class="fu">=</span> init
        , update <span class="fu">=</span> update
        , view <span class="fu">=</span> view
        , subscriptions <span class="fu">=</span> \_ <span class="ot">-&gt;</span> Sub.none }</code></pre></div>
<p><strong>App now renders without errors!</strong></p>
<p>Ok. Looks like there is a lot of going on. <a href="https://gist.github.com/turboMaCk/98d2e40231c4033deca29c148d4684cc#file-repos-elm">This is</a> how whole code looks like after these changes.</p>
<h2 id="goodbye-effects">Goodbye Effects!</h2>
<p>So app is kind of working now. They said if it compile, than it works, right? Anyway it’s not much useful since it do nothing. I think it’s good time to have a look at Effects. With Http working we will be able to fetch first data which seems to be reasonable next stage.</p>
<p>Looking at the <a href="http://package.elm-lang.org/packages/evancz/elm-http/3.0.1/">new api documentation</a> I think we will no longer need function for transforming Results to Action. I started by removing this one. Also one for creating Effects Action seems to be useless. Let’s remove this one too.</p>
<p>Let’s have a look at fetchData function. Looks like we will need to change this one a little bit. Here is old version:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">fetchData <span class="fu">:</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Task.Task</span> a (<span class="dt">Result</span> <span class="dt">Http.Error</span> (<span class="dt">List</span> <span class="dt">Repo</span>))
fetchData name <span class="fu">=</span>
    Http.get reposDecoder (getUrl name)
    <span class="fu">|&gt;</span> Task.toResult</code></pre></div>
<p>new implementation looks like:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">fetchData <span class="fu">:</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Cmd</span> <span class="dt">Msg</span>
fetchData name <span class="fu">=</span>
    <span class="kw">let</span> url <span class="fu">=</span>
        getUrl name
    <span class="kw">in</span>
        Task.perform <span class="dt">FetchFail</span> <span class="dt">FetchDone</span> (Http.get reposDecoder url)</code></pre></div>
<p>As you can see we will need to change error handling logic. In my case I just added Type <strong>FetchFail</strong> to <strong>Msg</strong> union type.** Thir also means we need to add this branch to pattern matching inside update function. Lets replace old <strong>Error</strong> with new <strong>FetchFail</strong>. We can reuse old <strong>httpErrorToString</strong> function for transforming <strong>Error</strong> to <strong>String</strong>.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">type</span> <span class="dt">Msg</span> <span class="fu">=</span> <span class="dt">NoOp</span>
    <span class="fu">|</span> <span class="dt">FetchData</span> <span class="dt">String</span>
    <span class="fu">|</span> <span class="dt">FetchDone</span> (<span class="dt">List</span> <span class="dt">Repo</span>)
    <span class="fu">|</span> <span class="dt">FetchFail</span> <span class="dt">Http.Error</span> <span class="co">-- THIS!!!!!!!!!!!</span>
    <span class="fu">|</span> <span class="dt">NameChanged</span> <span class="dt">String</span>
    <span class="fu">|</span> <span class="dt">SelectRepo</span> <span class="dt">Repo</span>
    <span class="fu">|</span> <span class="dt">ChangeSort</span> <span class="dt">SortBy</span>

update <span class="fu">:</span> <span class="dt">Msg</span> <span class="ot">-&gt;</span> <span class="dt">Model</span> <span class="ot">-&gt;</span> (<span class="dt">Model</span>, <span class="dt">Cmd</span> <span class="dt">Msg</span>)
update msg model <span class="fu">=</span>
    <span class="kw">case</span> msg <span class="kw">of</span>
        <span class="dt">NoOp</span> <span class="ot">-&gt;</span>
            ( model, Cmd.none )
        <span class="dt">FetchData</span> name <span class="ot">-&gt;</span>
            ( { model
                <span class="fu">|</span> isLoading <span class="fu">=</span> <span class="dt">True</span>
                , resultsFor <span class="fu">=</span> model<span class="fu">.</span>userName }
                , Cmd.none )
            — , fetchDataAsEffects model<span class="fu">.</span>userName )
        <span class="dt">FetchDone</span> results <span class="ot">-&gt;</span>
            ( { model
                <span class="fu">|</span> repos <span class="fu">=</span> results
                , isLoading <span class="fu">=</span> <span class="dt">False</span>
                , alert <span class="fu">=</span> “” }
                , Cmd.none )
        <span class="dt">FetchFail</span> error <span class="ot">-&gt;</span> <span class="co">-- THIS!!!!!!!!!!!!</span>
            ( { model
                <span class="fu">|</span> repos <span class="fu">=</span> []
                , isLoading <span class="fu">=</span> <span class="dt">False</span>
                , alert <span class="fu">=</span> (httpErrorToString model<span class="fu">.</span>userName error) }
                , Cmd.none )</code></pre></div>
<p>Nice! App should now compile without errors.</p>
<p>Now we can change init function and try if it works. Change:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">init <span class="fu">:</span> ( <span class="dt">Model</span>, <span class="dt">Cmd</span> <span class="dt">Msg</span> )
init <span class="fu">=</span>
    ( initialModel
    , fetchDataAsEffects initialModel<span class="fu">.</span>userName )</code></pre></div>
<p>to:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">init <span class="fu">:</span> ( <span class="dt">Model</span>, <span class="dt">Cmd</span> <span class="dt">Msg</span> )
init <span class="fu">=</span>
    ( initialModel
    , fetchData initialModel<span class="fu">.</span>userName )</code></pre></div>
<p><strong>It works! There is no compile error, request is sent and results are rendered. So far so good!</strong></p>
<p>To complete this part we can just remove <strong>Cmd.none</strong> and call <strong>fetchData</strong> in update function’s <strong>FetchData</strong> branch which will be triggered later via user interactions.</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">    <span class="dt">FetchData</span> name <span class="ot">-&gt;</span>
        ( { model
            <span class="fu">|</span> isLoading <span class="fu">=</span> <span class="dt">True</span>
            , resultsFor <span class="fu">=</span> model<span class="fu">.</span>userName }
            , fetchData model<span class="fu">.</span>userName )</code></pre></div>
<p><a href="https://gist.github.com/turboMaCk/a2f9b204f3259fb2be10754e4ad10565#file-repos-elm">This</a> is snapshot of code at this stage:</p>
<h2 id="events">Events</h2>
<p>We are almost finished. Last missing step is to bring back events to allow user interactions.</p>
<p>I’d like to start with uncommenting Events.onClick and removing address argument like this:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">[ button
    [ <span class="kw">class</span> (classNames <span class="dt">Name</span>)
    — , Events.onClick address (<span class="dt">ChangeSort</span> <span class="dt">Name</span>) ]
    ]
    [ text “name” ]</code></pre></div>
<p>new version:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">[ button
    [ <span class="kw">class</span> (classNames <span class="dt">Name</span>)
    , Events.onClick (<span class="dt">ChangeSort</span> <span class="dt">Name</span>) ]
    [ text “name” ]</code></pre></div>
<p><strong>Now sorting buttons and repository description should work.</strong></p>
<p>This is cool but we are still missing user name update and form submitting. In forms I’d like to use submit instead click since this makes Enter and other handy UX tweaks for mobile. Do you remember that two functions we previously commented out? One of the did the trick with Submit, other one hooks input event. Let’s have a look at <strong>Html.Events</strong> <a href="http://package.elm-lang.org/packages/elm-lang/html/1.0.0/Html-Events">documentation</a>.</p>
<p><strong>Looks like new version have these two build in!</strong></p>
<p>This means we can <strong>remove both commented functions</strong> and give the build-in ones a try.</p>
<p>change:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">input
    [ value model<span class="fu">.</span>userName
    — , onInput address <span class="dt">NameChanged</span>
    , <span class="kw">class</span> “search<span class="fu">-</span>field” ] []</code></pre></div>
<p>to:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">input
    [ value model<span class="fu">.</span>userName
    , Events.onInput <span class="dt">NameChanged</span> ] []</code></pre></div>
<p>and:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">Html.form
    — [ onSubmit address model<span class="fu">.</span>userName
    [ <span class="kw">class</span> “search<span class="fu">-</span>form” ]</code></pre></div>
<p>to:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">Html.form
    [ Events.onSubmit (<span class="dt">FetchData</span> model<span class="fu">.</span>userName)
    , <span class="kw">class</span> “search<span class="fu">-</span>form” ]</code></pre></div>
<p><strong>We are (almost) done!</strong></p>
<p><a href="https://gist.github.com/turboMaCk/ab2ef6e7f9ac393645faa0c6754dda29#file-repos-elm">This</a> is final version of our new implementation.</p>
<h2 id="load-app-in-html">Load app in Html</h2>
<p>Last step is to make new version of application work with Html. Just follow upgrading guide. This how mine index.html looks like:</p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="dt">&lt;!DOCTYPE </span>HTML<span class="dt">&gt;</span>
<span class="kw">&lt;html&gt;</span>
    <span class="kw">&lt;head&gt;</span>
        <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">”UTF-8</span><span class="er">&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;title&gt;</span>Github repository browser<span class="kw">&lt;/title&gt;</span>
        <span class="kw">&lt;link</span><span class="ot"> href=</span><span class="st">’https://fonts.googleapis.com/css?family=Open+Sans</span><span class="er">'</span><span class="ot"> rel=</span><span class="st">’stylesheet’</span><span class="ot"> type=</span><span class="st">’text/css’</span><span class="kw">&gt;</span>
        <span class="kw">&lt;link</span><span class="ot"> href=</span><span class="st">’https://fonts.googleapis.com/css?family=Lato:100italic</span><span class="er">'</span><span class="ot"> rel=</span><span class="st">’stylesheet’</span><span class="ot"> type=</span><span class="st">’text/css’</span><span class="kw">&gt;</span>
        <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">”stylesheet”</span><span class="ot"> href=</span><span class="st">”dist/styles/main.css”</span><span class="kw">&gt;</span>
        <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">”text/javascript”</span><span class="ot"> src=</span><span class="st">”dist/Repos.js”</span><span class="kw">&gt;&lt;/script&gt;</span>
    <span class="kw">&lt;/head&gt;</span>
    <span class="kw">&lt;body&gt;</span>
        <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">”text/javascript”</span><span class="kw">&gt;</span>
            <span class="kw">var</span> app <span class="op">=</span> <span class="va">Elm</span>.<span class="va">Repos</span>.<span class="at">fullscreen</span>()<span class="op">;</span>
        <span class="op">&lt;</span><span class="ss">/script&gt;</span>
<span class="ss">    &lt;/body</span><span class="op">&gt;</span>
<span class="op">&lt;</span><span class="ss">/html&gt;</span></code></pre></div>
<p>Nothing too fancy. As you can see there is new api for rendering app in fullscreen.</p>
<p>just change:</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">var</span> app <span class="op">=</span> <span class="va">Elm</span>.<span class="at">fullscreen</span>(<span class="va">Elm</span>.<span class="at">Repos</span>)<span class="op">;</span></code></pre></div>
<p>to new version:</p>
<div class="sourceCode"><pre class="sourceCode js"><code class="sourceCode javascript"><span class="kw">var</span> app <span class="op">=</span> <span class="va">Elm</span>.<span class="va">Repos</span>.<span class="at">fullscreen</span>()<span class="op">;</span></code></pre></div>
<p>That’s it. We are done!</p>
<h2 id="or-not-edited-on-may-28th">Or not? (edited on May 28th)</h2>
<p>As <a href="https://www.reddit.com/user/jediknight">jediknight</a> pointed out in <a href="https://www.reddit.com/r/elm/comments/4jhaxf/elm_017_successful_upgrade_of_real_world_app_and/">discussion on reddit</a> there is actually much nicer way how to create model msg tuple using <code>!</code> infix function! I recommend to use it since it adds some extra abstraction to your actions. This function takes two a arguments — model (whatever) and List of Msg. Let’s see how we can use it.</p>
<p>this is on of our old update branches:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">update msg model <span class="fu">=</span>
    <span class="kw">case</span> msg <span class="kw">of</span>
        <span class="dt">NoOp</span> <span class="ot">-&gt;</span>
            ( model, Cmd.none )</code></pre></div>
<p>and this is how it looks like with use of <code>!</code> function</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">update msg model <span class="fu">=</span>
    <span class="kw">case</span> msg <span class="kw">of</span>
        <span class="dt">NoOp</span> <span class="ot">-&gt;</span>
            model <span class="fu">!</span> []</code></pre></div>
<p>As always <a href="https://gist.github.com/turboMaCk/a77498c85347eda4581b6be08be8c3ef#file-repos-elm">here</a> is shippet of whole application.</p>
<h2 id="conclusion">Conclusion</h2>
<p>I think this demonstrates one possible pattern of how to upgrade your web app written in elm to version 0.17. We started with views. Removing all calls to code we do not need to just get initial render. Then fixing update function and main (StartApp) code. Doing so bring us to state where we were able to get initial render. Then we made Http work so our app was able to fetch data a render them. We made events work so user can interact with app as before. And finally we connected our app to html.</p>
<h2 id="elm-architecture-types">Elm, Architecture, Types…</h2>
<p>Somewhere above I was taking about how hard it is to upgrade your application. I also mentioned few examples where the difference between legacy and new API made it almost impossible to upgrade existing code bases. I think <strong>with elm the situation is different</strong>.</p>
<p>This is on of scenarios where types really cover your back. Thanks to the fact that elm is <a href="https://en.wikipedia.org/wiki/Strong_and_weak_typing">strongly</a> and <a href="http://stackoverflow.com/questions/1517582/what-is-the-difference-between-statically-typed-and-dynamically-typed-languages">statically</a> typed it’s <strong>not such a big deal to introduce huge API changes</strong> as 0.17 did. I’m not a hardcore static type fan boy. I think there are big trade offs while choosing static over dynamic typed languages. Dynamic typing should be pretty powerful in some cases. I’m also pretty big fan of meta programming (think about Lisp(s) or Ruby). Anyway with static typing comes some extra safety. Extra safety in terms that you no need to be afraid start aggressively rewriting parts of your code. I think this is one thing Elm really shines in. My bets on Elm are pretty high thanks to this. I think Elm’s community can really benefits of this nature of safety. I expect there is <strong>bright future for Elm as language and architecture</strong>. The potential of bringing cutting edge concepts and constantly iterating on all its building blocks can really runs over whole <strong>React</strong> and <strong>Clojure Script</strong> word. I strongly believe that neither of these ecosystems will be able to implement experimental primitives rethink its design and more importantly bring all of this easily to large scale production applications as Elm can.</p>
<p>Thanks to everyone in this community for making all of this happened. I’m super excited about what came next.</p>


<div class="reddit-discussion">
  <img src="../assets/reddit.png" alt="redit" class="reddit-logo">
  Since I'm not a fan of disqus or any other commenting system there is no disscusion under this post.<br>
  However I do like reddit as a platform so feel free to shout here:<br>
  <a href="https://www.reddit.com//r/elm/comments/4jhaxf/elm_017_successful_upgrade_of_real_world_app_and/">/r/elm/comments/4jhaxf/elm_017_successful_upgrade_of_real_world_app_and/</a>
</div>


      </div>
      <div id="footer">
        <a href="https://github.com/turboMaCk/turboMaCk.github.io">Source</a> available under BSD-3-Clause.<br>
        Content is pubished under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.<br>
        Proudly powered by <a href="http://jaspervdj.be/hakyll">Hakyll</a>; Theme by Marek Fajkus
      </div>
    </main>
  </body>
</html>
